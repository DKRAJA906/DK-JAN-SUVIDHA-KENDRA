<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desi WPS Editor - By DK Jan Suvidha</title>
    <!-- ‡§á‡§® ‡§§‡•Ä‡§® ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä‡§ú‡§º ‡§∏‡•á ‡§π‡•Ä ‡§ú‡§æ‡§¶‡•Ç ‡§π‡•ã‡§ó‡§æ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        body { font-family: sans-serif; background: #f0f0f0; margin: 0; padding: 10px; }
        .toolbar {
            position: fixed; top: 0; left: 0; right: 0;
            background: #2c3e50; padding: 10px; display: flex; gap: 10px;
            z-index: 1000; overflow-x: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        button {
            padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer;
            font-weight: bold; white-space: nowrap;
        }
        .btn-upload { background: #3498db; color: white; }
        .btn-eraser { background: #e74c3c; color: white; } /* ‡§∏‡§´‡§º‡•á‡§¶ ‡§™‡§ü‡•ç‡§ü‡•Ä */
        .btn-text { background: #f1c40f; color: black; }
        .btn-save { background: #27ae60; color: white; margin-left: auto; }
        
        #canvas-container {
            margin-top: 60px; 
            display: flex; 
            justify-content: center;
            overflow: auto;
            padding-bottom: 50px;
        }
        .canvas-box { box-shadow: 0 0 10px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

    <div class="toolbar">
        <input type="file" id="fileInput" accept="application/pdf" style="display:none">
        <button class="btn-upload" onclick="document.getElementById('fileInput').click()">üìÇ Open PDF</button>
        
        <button class="btn-eraser" onclick="addEraser()">‚¨ú Eraser (Whiteout)</button>
        <button class="btn-text" onclick="addText()">Tb Add Text</button>
        <button onclick="deleteSelected()">üóëÔ∏è Delete Item</button>
        
        <button class="btn-save" onclick="downloadPDF()">üíæ Save PDF</button>
    </div>

    <div id="canvas-container">
        <canvas id="c" class="canvas-box"></canvas>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        // 1. Fabric Canvas ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç (‡§Ø‡§π‡•Ä ‡§π‡•à ‡§Ö‡§∏‡§≤‡•Ä ‡§è‡§°‡§ø‡§ü‡§∞)
        const canvas = new fabric.Canvas('c');
        let pdfDoc = null;

        // PDF ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§ó‡§æ
        document.getElementById('fileInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const arrayBuffer = await file.arrayBuffer();
            pdfDoc = await pdfjsLib.getDocument(arrayBuffer).promise;
            
            // ‡§Ö‡§≠‡•Ä ‡§π‡§Æ ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§™‡§π‡§≤‡•á ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á (‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§ï‡•á ‡§≤‡§ø‡§è)
            renderPage(1);
        });

        async function renderPage(num) {
            const page = await pdfDoc.getPage(num);
            const viewport = page.getViewport({ scale: 1.5 }); // 1.5 scale HD ‡§ï‡•ç‡§µ‡§æ‡§≤‡§ø‡§ü‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è

            // PDF ‡§ï‡•ã ‡§è‡§ï ‡§õ‡§ø‡§™‡•á ‡§π‡•Å‡§è ‡§ï‡•à‡§®‡§µ‡§æ‡§∏ ‡§™‡§∞ ‡§°‡•ç‡§∞‡§æ ‡§ï‡§∞‡•á‡§Ç
            const hiddenCanvas = document.createElement('canvas');
            const context = hiddenCanvas.getContext('2d');
            hiddenCanvas.height = viewport.height;
            hiddenCanvas.width = viewport.width;

            await page.render({ canvasContext: context, viewport: viewport }).promise;

            // ‡§õ‡§ø‡§™‡•á ‡§π‡•Å‡§è ‡§ï‡•à‡§®‡§µ‡§æ‡§∏ ‡§ï‡•ã Fabric Canvas ‡§ï‡•á ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            const bgImage = hiddenCanvas.toDataURL("image/png");
            
            fabric.Image.fromURL(bgImage, function(img) {
                canvas.setWidth(viewport.width);
                canvas.setHeight(viewport.height);
                canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
            });
        }

        // --- ‡§ü‡•Ç‡§≤‡•ç‡§∏ (Tools) ---

        // 2. Eraser (‡§™‡•Å‡§∞‡§æ‡§®‡§æ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§Æ‡§ø‡§ü‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§´‡§º‡•á‡§¶ ‡§™‡§ü‡•ç‡§ü‡•Ä)
        function addEraser() {
            const rect = new fabric.Rect({
                left: 100, top: 100, fill: 'white', 
                width: 100, height: 30,
                borderColor: 'red', cornerColor: 'red' // ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§≤‡§æ‡§≤ ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ
            });
            canvas.add(rect);
            canvas.setActiveObject(rect);
        }

        // 3. ‡§®‡§Ø‡§æ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è
        function addText() {
            const text = new fabric.IText('Type Here', {
                left: 150, top: 150,
                fontFamily: 'Arial', fontSize: 20, fill: 'black'
            });
            canvas.add(text);
            canvas.setActiveObject(text);
        }

        // 4. ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡•Ä ‡§ó‡§à ‡§ö‡•Ä‡§ú‡§º ‡§π‡§ü‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è
        function deleteSelected() {
            const activeObj = canvas.getActiveObject();
            if (activeObj) {
                canvas.remove(activeObj);
            }
        }

        // --- PDF ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡§æ ---
        function downloadPDF() {
            // ‡§ï‡•à‡§®‡§µ‡§æ‡§∏ ‡§ï‡•ã ‡§á‡§Æ‡•á‡§ú ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç
            const dataURL = canvas.toDataURL({ format: 'png', quality: 1 });
            const { jsPDF } = window.jspdf;
            
            // ‡§á‡§Æ‡•á‡§ú ‡§ï‡•á ‡§∏‡§æ‡§á‡§ú‡§º ‡§ï‡•á ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§∏‡•á PDF ‡§¨‡§®‡§æ‡§è‡§Ç
            const pdf = new jsPDF({
                orientation: canvas.width > canvas.height ? 'l' : 'p',
                unit: 'px',
                format: [canvas.width, canvas.height]
            });

            pdf.addImage(dataURL, 'PNG', 0, 0, canvas.width, canvas.height);
            pdf.save("edited-document.pdf");
        }
    </script>
</body>
</html>
